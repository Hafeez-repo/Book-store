
{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the online bookstore.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "firebaseUid": {
          "type": "string",
          "description": "The unique user ID provided by Firebase Authentication."
        },
        "name": {
          "type": "string",
          "description": "The user's full name."
        },
        "email": {
          "type": "string",
          "description": "The user's email address.",
          "format": "email"
        },
        "address": {
          "type": "string",
          "description": "The user's shipping address."
        },
        "profilePictureUrl": {
          "type": "string",
          "description": "URL of the user's profile picture stored in Firebase Storage."
        }
      },
      "required": [
        "id",
        "firebaseUid",
        "name",
        "email"
      ]
    },
    "Book": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Book",
      "type": "object",
      "description": "Represents a book in the online bookstore.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the book."
        },
        "title": {
          "type": "string",
          "description": "The title of the book."
        },
        "author": {
          "type": "string",
          "description": "The author of the book."
        },
        "genre": {
          "type": "string",
          "description": "The genre of the book."
        },
        "price": {
          "type": "number",
          "description": "The price of the book."
        },
        "stock": {
          "type": "number",
          "description": "The number of copies of the book in stock."
        },
        "description": {
          "type": "string",
          "description": "A description of the book."
        },
        "rating": {
          "type": "number",
          "description": "The average rating of the book."
        },
        "coverImageUrl": {
          "type": "string",
          "description": "URL of the book's cover image stored in Firebase Storage."
        }
      },
      "required": [
        "id",
        "title",
        "author",
        "genre",
        "price",
        "stock",
        "description",
        "coverImageUrl"
      ]
    },
    "OrderItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Order Item",
      "type": "object",
      "description": "Represents a single book item within an order, capturing its state at the time of purchase.",
      "properties": {
        "bookId": {
          "type": "string",
          "description": "The ID of the book."
        },
        "title": {
          "type": "string",
          "description": "The title of the book at the time of purchase."
        },
        "author": {
          "type": "string",
          "description": "The author of the book at the time of purchase."
        },
        "price": {
          "type": "number",
          "description": "The price of the book at the time of purchase."
        },
        "quantity": {
          "type": "number",
          "description": "The quantity of the book purchased."
        },
        "coverImage": {
            "type": "string",
            "description": "The cover image ID of the book at the time of purchase."
        }
      },
      "required": ["bookId", "title", "author", "price", "quantity", "coverImage"]
    },
    "Order": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Order",
      "type": "object",
      "description": "Represents an order placed by a user, containing a snapshot of the items purchased.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the order."
        },
        "userId": {
          "type": "string",
          "description": "The ID of the user who placed the order. (Relationship: User 1:N Order)"
        },
        "items": {
          "type": "array",
          "description": "An array of book items included in the order.",
          "items": {
            "$ref": "#/backend/entities/OrderItem"
          }
        },
        "totalPrice": {
          "type": "number",
          "description": "The total price of the order."
        },
        "paymentMethod": {
            "type": "string",
            "description": "The payment method used for the order (e.g. credit-card, cod)"
        },
        "paymentStatus": {
          "type": "string",
          "description": "The payment status of the order (e.g., pending, completed, failed)."
        },
        "timestamp": {
          "type": "string",
          "description": "The timestamp of when the order was placed.",
          "format": "date-time"
        },
        "status": {
          "type": "string",
          "description": "The status of the order (e.g., pending, shipped, delivered, cancelled)."
        }
      },
      "required": [
        "id",
        "userId",
        "items",
        "totalPrice",
        "paymentMethod",
        "paymentStatus",
        "timestamp",
        "status"
      ]
    },
    "Review": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Review",
      "type": "object",
      "description": "Represents a review of a book by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the review."
        },
        "bookId": {
          "type": "string",
          "description": "The ID of the book being reviewed. (Relationship: Book 1:N Review)"
        },
        "userId": {
          "type": "string",
          "description": "The ID of the user who wrote the review. (Relationship: User 1:N Review)"
        },
        "rating": {
          "type": "number",
          "description": "The rating given by the user (e.g., 1-5)."
        },
        "comment": {
          "type": "string",
          "description": "The comment provided by the user."
        },
        "createdAt": {
          "type": "string",
          "description": "The timestamp of when the review was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "bookId",
        "userId",
        "rating",
        "comment",
        "createdAt"
      ]
    },
    "CartItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "CartItem",
      "type": "object",
      "description": "Represents an item in the user's shopping cart.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the cart item."
        },
        "userId": {
          "type": "string",
          "description": "The ID of the user who owns the cart. (Relationship: User 1:N CartItem)"
        },
        "bookId": {
          "type": "string",
          "description": "The ID of the book in the cart. (Relationship: Book 1:1 CartItem)"
        },
        "quantity": {
          "type": "number",
          "description": "The quantity of the book in the cart."
        }
      },
      "required": [
        "id",
        "userId",
        "bookId",
        "quantity"
      ]
    },
    "WishlistItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "WishlistItem",
      "type": "object",
      "description": "Represents an item in a user's wishlist.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the wishlist item."
        },
        "userId": {
          "type": "string",
          "description": "The ID of the user who owns the wishlist. (Relationship: User 1:N WishlistItem)"
        },
        "bookId": {
          "type": "string",
          "description": "The ID of the book in the wishlist. (Relationship: Book 1:1 WishlistItem)"
        }
      },
      "required": [
        "id",
        "userId",
        "bookId"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information. The {userId} is the Firebase Auth UID.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase UID of the user."
            }
          ]
        }
      },
      {
        "path": "/books/{bookId}",
        "definition": {
          "entityName": "Book",
          "schema": {
            "$ref": "#/backend/entities/Book"
          },
          "description": "Stores all book information for the store. This collection is publicly readable.",
          "params": [
            {
              "name": "bookId",
              "description": "The unique ID of the book."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/cartItems/{cartItemId}",
        "definition": {
          "entityName": "CartItem",
          "schema": {
            "$ref": "#/backend/entities/CartItem"
          },
          "description": "A subcollection storing items in a specific user's shopping cart. Access is restricted to the user.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase UID of the user."
            },
            {
              "name": "cartItemId",
              "description": "The unique ID of the cart item."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/wishlistItems/{wishlistItemId}",
        "definition": {
          "entityName": "WishlistItem",
          "schema": {
            "$ref": "#/backend/entities/WishlistItem"
          },
          "description": "A subcollection storing items in a specific user's wishlist. Access is restricted to the user.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase UID of the user."
            },
            {
              "name": "wishlistItemId",
              "description": "The unique ID of the wishlist item."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/orders/{orderId}",
        "definition": {
          "entityName": "Order",
          "schema": {
            "$ref": "#/backend/entities/Order"
          },
          "description": "A subcollection storing order history for a specific user. Access is restricted to the user.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase UID of the user."
            },
            {
              "name": "orderId",
              "description": "The unique ID of the order."
            }
          ]
        }
      },
      {
        "path": "/books/{bookId}/reviews/{reviewId}",
        "definition": {
          "entityName": "Review",
          "schema": {
            "$ref": "#/backend/entities/Review"
          },
          "description": "A subcollection storing reviews for a specific book. Publicly readable, but only the review author can create one.",
          "params": [
            {
              "name": "bookId",
              "description": "The unique ID of the book."
            },
            {
              "name": "reviewId",
              "description": "The unique ID of the review."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to support the online bookstore application, focusing on user authentication, book browsing, order management, and reviews. The structure prioritizes authorization independence by denormalizing user roles into the documents where authorization is required, eliminating the need for `get()` calls in security rules. This design supports secure `list` operations and atomic operations for transactions and batches.\n\n**Data Organization:**\n* **`/users/{userId}`**: Each user has a root document containing their public profile. All user-specific, private data (like carts, orders, and wishlists) are stored in subcollections within this user document. This is a best practice for security, as rules can easily lock down all subcollections to just the document owner.\n* **`/books/{bookId}`**: This is a root-level collection containing all book information. It's kept separate from users because it's public data that all users need to access. Storing reviews as a subcollection of each book keeps related data together.\n\nThis structure allows for efficient and secure data access. For example, to get a user's cart, you only need to query the `/users/{userId}/cartItems` subcollection, and security rules can ensure that only the authenticated user with the matching `{userId}` can do so."
  }
}
